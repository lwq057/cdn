String.prototype.htmlSCUnescape=function(){var entityMap={'&amp;':'&','&lt;':'<','&gt;':'>','&quot;':'"','&#39;':"'",'&#x2F;':'/','&#x60;':'`','&#x3D;':'='};return this.replace(/&(amp|lt|gt|quot|#39|#x2F|#x60|#x3D);/g,function(s){return entityMap[s]})};String.prototype.htmlSCEscape=function(){var entityMap={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;'};return this.replace(/[&<>"'`=\/]/g,function(s){return entityMap[s]})};(function(){var htmls='';if(document.querySelector('label[for="release"]')){htmls+='<input hide type="checkbox" id="release"><dialog release><div head>视频分享投稿</div><form action="/release/url"><div main><input type="text"placeholder="视频播放地址"name="url" required><div><p>目前只支持 哔哩哔哩、优酷、腾讯视频、爱奇艺 等视频网站</p><p>输入视频播放地址后提交即可</p><p>请投稿与说唱相关视频</p></div></div><div foot><button type="submit">提交</button><label for="release">取消</label></div></form></dialog>'}if(document.querySelector('label[for="support"]')){htmls+='<input hide type="checkbox" id="support"><dialog><div head>赞助我们</div><div main><img src="https://cdn.jsdelivr.net/gh/lwq057/cdn@1.5/mc.k7dj.com/sponsor.png"><p>感谢您的支持让我们更好的前行</p></div><div foot><label for="support">确定</label></div></dialog>'}if(document.querySelector('label[for="share"]')){var html='';var url=location.href;var title=document.title;var description=document.querySelector('meta[name="description"][content]')?document.querySelector('meta[name="description"]').getAttribute('content'):'';var keywords=document.querySelector('meta[name="keywords"][content]')?document.querySelector('meta[name="keywords"]').getAttribute('content').split(','):['说唱'];var img=document.querySelector('meta[property="og:image"][content]')?document.querySelector('meta[property="og:image"]').getAttribute('content'):(document.images.length?document.images[0].src:'');var site=location.hostname;html+='<p><img src="http://qr.kegood.com/?m=0&e=L&p=5&url='+encodeURIComponent(url)+'"></p>';html+='<nav>';html+='<a href="http://service.weibo.com/share/share.php?url='+url+'&title='+encodeURIComponent((keywords.length?'#'+keywords.join('# #')+'#':'')+'\n《'+title+'》\n'+description)+'&pic='+img+'" target="_blank">新浪微博</a>';html+='<a href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url='+url+'&title='+title+'&pics='+img+'&site='+site+'" target="_blank">QQ空间</a>';html+='<a href="http://tieba.baidu.com/f/commit/share/openShareApi?url='+encodeURIComponent(url)+'&title='+title+'&pic='+img.replace('https://','http://')+'&site='+site+'" target="_blank">百度贴吧</a>';html+='<a href="https://www.douban.com/share/service?href='+url+'&name='+title+'&image='+img+'&site='+site+'&text='+encodeURIComponent(description)+'" target="_blank">豆瓣</a>';html+='<a href="https://connect.qq.com/widget/shareqq/index.html?url='+encodeURIComponent(url)+'&title='+title+'&pics='+img+'&desc='+encodeURIComponent(description)+'" target="_blank">QQ好友</a>';html+='<a href="https://www.facebook.com/share.php?u='+url+'&t='+title+'&pic='+img.replace('https://','http://')+'" target="_blank">Facebook</a>';html+='<a href="https://twitter.com/intent/tweet?url='+encodeURIComponent(url)+'&text='+encodeURIComponent(description)+'&pic='+encodeURIComponent(img)+'&hashtags='+(keywords.length?keywords[0]:'')+'" target="_blank">Twitter</a>';html+='<a href="mailto:?subject='+title+'&body='+encodeURIComponent(description+'\n\n网址：'+url)+'" target="_blank">电子邮件</a>';html+='<a href="sms:?body='+encodeURIComponent(description)+'" target="_blank">短信</a>';html+='</nav>';htmls+='<input hide type="checkbox" id="share"><dialog share><div head>分享</div><div main>'+html+'</div><div foot><label for="share">确定</label></div></dialog>'}if(htmls){document.body.insertAdjacentHTML('beforeend',htmls)}})();function formatDuraton(time){if(time>-1){var hour=Math.floor(time/3600);var min=Math.floor(time/60)%60;var sec=Math.floor(time%60);time='';if(hour>0){if(hour<10){time='0'+hour+':'}else{time=hour+':'}}if(min<10){time+='0'}time+=min+':';if(sec<10){time+='0'}time+=sec}return time}function list_suraton(){var ls=document.querySelectorAll('section[list]>ul li>a>i');if(ls.length){for(var k in ls){var v=ls[k].innerText;if(v){if(v.indexOf(':')==-1){ls[k].innerText=formatDuraton(parseFloat(v))}}}}}list_suraton();(function(){if(self.frameElement){var head_foot=document.querySelectorAll('body>header,body>footer');for(var i=0;i<head_foot.length;i++){head_foot[i].parentNode.removeChild(head_foot[i])}}})();(function(){var a_dialog=document.querySelectorAll('a[dialog][href]');for(var i=0;i<a_dialog.length;i++){a_dialog[i].onclick=function(){var id=this.id||this.getAttribute('dialog')||'a'+Date.now();var url=this.href;if(document.querySelector('#'+id+'[type="checkbox"]')){document.getElementById(id).checked=!document.getElementById(id).checked;return false}if(!url){return false}document.body.insertAdjacentHTML('beforeend','<input hide type="checkbox" id="'+id+'" checked><dialog iframe '+id+'><iframe src="'+url+'"></iframe><label toggle for="'+id+'">X</label></dialog>');document.querySelector('dialog[iframe]['+id+'] iframe').onload=function(){this.style.height=this.contentWindow.document.body.scrollHeight+'px'}return false}}})();(function(){var backs=document.querySelectorAll('label[back]');if(backs.length){for(var i in backs){backs[i].onclick=function(){history.go(-1)}}}})();function AJAX(options){options=options||{};options.type=(options.type||"GET").toUpperCase();options.async=(options.async==undefined)?true:options.async;var params=options.processData==false?options.data:formatParams(options.data,(options.cache==false?true:false));if(window.XMLHttpRequest){var xhr=new XMLHttpRequest()}else{var xhr=new ActiveXObject("Microsoft.XMLHTTP")}if(options.type=='GET'){if(params){params='?'+params}xhr.open('GET',options.url+params,options.async);xhr.send()}else if(options.type=='POST'){xhr.open('POST',options.url,options.async);if(options.contentType!==false){xhr.setRequestHeader("Content-Type",options.contentType||'application/x-www-form-urlencoded')}xhr.send(params)}xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){options.success&&options.success(xhr.responseText,xhr)}else{options.error&&options.error(xhr)}}};function formatParams(data,rand){var arr=[];for(var k in data){if(typeof data[k]=='object'){if(data[k].name&&data[k].value){arr.push(encodeURIComponent(data[k].name)+"="+encodeURIComponent(data[k].value))}else{for(var kk in data[k]){arr.push(encodeURIComponent(kk)+"="+encodeURIComponent(data[k][kk]))}}}else{arr.push(encodeURIComponent(k)+"="+encodeURIComponent(data[k]))}}if(rand){arr.push('_='+Date.now())}return arr.join("&")}}function dialog_msg(html,id){if(!html){return false}id=id||'msg'+Date.now();function onclose(id,time){if(document.getElementById(id)){var ele=document.getElementById(id);ele.onclick=function(){this.style.display='none'}setTimeout(function(){ele.style.display='none'},time||6000)}}if(document.getElementById(id)){var ele=document.getElementById(id);ele.innerHTML='<div main>'+html+'</div>';ele.style.display='inline-block';onclose(id,html.length*1000);return true}var dialog='<dialog msg id="'+id+'"><div main>'+html+'</div></dialog>';document.body.insertAdjacentHTML('beforeend',dialog);onclose(id,html.length*1000);return true}(function(){var play_form=document.querySelector('section[play]>form');if(play_form){var play_form_submitter={name:'like',innerText:0};play_form.querySelector('[name="like"]').onclick=function(){play_form_submitter=this}play_form.querySelector('[name="dislike"]').onclick=function(){play_form_submitter=this}play_form.onsubmit=function(ev){var ev=ev||window.event;if(ev.preventDefault){ev.preventDefault()}else{ev.returnValue=false}var data={ajax:true}if(ev.submitter){play_form_submitter=ev.submitter}data[play_form_submitter.name]=true;data.token=this.token.value;AJAX({url:this.action,type:'POST',data:data,success:function(data,xhr){console.log(data,xhr);try{var json=JSON.parse(data);if(json.message){dialog_msg(json.message,'videos_msg');if(json.add){play_form_submitter.innerText=parseInt(play_form_submitter.innerText)+1}}else{dialog_msg('处理异常','videos_msg')}}catch(error){dialog_msg('处理异常，请重试','videos_msg')}},error:function(xhr){try{var json=JSON.parse(xhr.responseText);if(json.message){dialog_msg(json.message,'comment_msg');return}}catch(error){}dialog_msg('处理异常，请重试','videos_msg');console.error(xhr)}});return false}}})();(function(){var comment_form=document.getElementById('comment');if(comment_form){var input_name=comment_form.querySelector('input[name="name"]')if(input_name&&!input_name.value){var cookie_comment_name_match=document.cookie.match(/(^| )comment_name=([^;]*)(;|$)/);if(cookie_comment_name_match&&cookie_comment_name_match[2]){input_name.value=decodeURIComponent(cookie_comment_name_match[2])}}var comment_submit=false;comment_form.onsubmit=function(ev){var ev=ev||window.event;if(ev.preventDefault){ev.preventDefault()}else{ev.returnValue=false}if(comment_submit){dialog_msg('提交处理中','comment_msg');return false}if(!this.comment.value){dialog_msg('评论内容位必填项','comment_msg');return false}if(this.comment.value.length>1000){dialog_msg('评论内容超出最大长度1000','comment_msg');return false}comment_submit=true;var _this=this;AJAX({url:comment_form.action,type:'POST',data:{ajax:true,name:_this.name.value,comment:_this.comment.value,token:_this.token.value},success:function(data,xhr){comment_submit=false;console.log(data,xhr);try{var json=JSON.parse(data);if(json.message){dialog_msg(json.message,'comment_msg');_this.comment.value='';document.querySelector('section[comment] ul').insertAdjacentHTML('afterBegin',comment_list([{ID:json.ID,name:this.data.name,info:comment_content(this.data.comment.htmlSCEscape()),time:Date.now()}]))}else{dialog_msg('评论处理异常，可能已经成功','comment_msg')}}catch(error){dialog_msg('评论处理异常，请重试','comment_msg')}if(this.data.name){document.cookie='comment_name='+encodeURIComponent(this.data.name)+';expires=31536000000;path=/'}},error:function(xhr){comment_submit=false;try{var json=JSON.parse(xhr.responseText);if(json.message){dialog_msg(json.message,'comment_msg');return}}catch(error){}dialog_msg('评论处理异常，请重试','comment_msg');console.error(xhr)}});return false}}})();(function(){var comment_page=document.querySelector('section[comment]>nav[page][ajax]');if(comment_page){var comment_page_total=comment_page.getAttribute('total');var comment_ul=document.querySelector('section[comment] ul');comment_page.onclick=function(event){if(event.target.nodeName=='A'){var a=event.target;if(!a.href){return true}AJAX({url:a.href,type:'GET',data:{ajax:'comment'},success:function(data,xhr){try{var json=JSON.parse(data);if(json.list&&json.list.length){json.page.total=json.page.total||comment_page_total;if(!json.page.total){json.page.max=(json.list.length==json.page.size)?json.page.page+1:json.page.page}window.scrollTo(0,document.documentElement.scrollTop-comment_ul.offsetHeight);comment_page.setAttribute('page',json.page.page);comment_ul.innerHTML=comment_list(json.list);comment_page.innerHTML=pages(json.page,false);comment_li_content()}else{dialog_msg('没有更多评论了','comment_page_msg')}}catch(error){dialog_msg('评论数据异常','comment_page_msg')}},error:function(xhr){try{var json=JSON.parse(xhr.responseText);if(json.message){dialog_msg(json.message,'comment_page_msg');return}}catch(error){}console.error(xhr);dialog_msg('评论数据异常','comment_page_msg')}});return false}}}})();(function(){var release_form=document.querySelector('dialog[release]>form');if(release_form){var release_info_div=release_form.querySelector('dialog[release] [main]>div');var release_submit=false;function release_info(url,msg,vid,state){var html='';if(msg){html+='<p>投稿情况：'+msg+'</p>'}if(vid){html+='<p>';html+='视频编号：<a href="/video-'+vid+'/">video-'+vid+'</a>';if(state!=undefined){switch(state){case 0:html+=' （待审）';break;case 1:html+=' （正常）';break;case 2:html+=' （屏蔽）';break}}html+='</p>'}if(url){html+='<p>视频地址：'+url+'</p>'}release_info_div.innerHTML=html}release_form.onsubmit=function(ev){var ev=ev||window.event;if(ev.preventDefault){ev.preventDefault()}else{ev.returnValue=false}if(release_submit){dialog_msg('提交处理中','release_msg');return false}if(!this.url.value){dialog_msg('分享地址必填项','release_msg');return false}var url=this.url.value.trim();if(url.indexOf('http://')!=0&&url.indexOf('https://')!=0){dialog_msg('分享地址不正确','release_msg');return false}if((url.indexOf('bilibili.com/')!=-1||url.indexOf('v.qq.com/')!=-1||url.indexOf('.youku.com/')!=-1||url.indexOf('.iqiyi.com/')!=-1)==false){dialog_msg('不支持此地址','release_msg');return false}release_submit=true;var _this=this;AJAX({url:release_form.action,type:'GET',data:{ajax:true,url:_this.url.value},success:function(data,xhr){release_submit=false;console.log(data,xhr);try{var json=JSON.parse(data);if(json.message){dialog_msg(json.message,'release_msg');_this.url.value='';release_info(this.data.url,json.message,json.ID,json.state)}else{release_info(this.data.url,'提交成功');dialog_msg('提交成功','release_msg')}}catch(error){release_info(this.data.url,'处理异常');dialog_msg('处理异常，请重试','release_msg')}},error:function(xhr){release_submit=false;try{var json=JSON.parse(xhr.responseText);if(json.message){dialog_msg(json.message,'release_msg');release_info(this.data.url,json.message,json.ID,json.state);return}}catch(error){}release_info(this.data.url,'处理异常');dialog_msg('处理异常，请重试','release_msg');console.error(xhr)}});return false}}})();function comment_content(data){var html='<p>';html+=data.replaceAll('\n','</p><p>');html+='</p>';return html}function comment_li_content(){var comment_list_li=document.querySelectorAll('section[comment] ul li');for(var i=0;i<comment_list_li.length;i++){var article=comment_list_li[i].querySelector('article');if(article){var html=comment_content(article.innerText);if(article.offsetHeight>300){article.setAttribute('fold',1);html+='<button type="button" fold="article"></button>'}article.innerHTML=html}}}(function(){var comment_ul_fold=document.querySelector('section[comment] ul');if(comment_ul_fold){comment_ul_fold.onclick=function(e){if(e.target.nodeName=='BUTTON'&&e.target.getAttribute('fold')){var article=e.target.parentNode;if(article.getAttribute('fold')=='1'){article.setAttribute('fold',0)}else{article.setAttribute('fold',1)}}}}})();comment_li_content();function comment_list(data){var html='';for(var k in data){html+='<li>';html+='<div>';html+='<span>'+(data[k].name||'匿名')+'</span>';html+='<time>'+(new Date(data[k].time).toLocaleString())+'</time>';if(data[k].state==1){html+='<button type="submit" name="like" value="'+data[k].ID+'">'+(data[k].like||0)+'</button>';html+='<button type="submit" name="dislike" value="'+data[k].ID+'">'+(data[k].dislike||0)+'</button>'}html+='</div>';html+='<article>'+data[k].info+'</article>';html+='</li>'}return html}function pages(data,nav){var html='';var url=function(p){return data.url.replace('{page}',p)}if(data.total||data.max){if(!data.max){var mp=data.total/data.size;if(mp%1>0){data.max=parseInt(mp)+1}else{data.max=mp}}if(data.page>3){html+=(data.page==1)?'':'<a href="'+url(1)+'">&lt;&lt;</a>'}var start;if(data.page>data.max){start=(data.max-2)>0?data.max-2:1;for(var i=start;i<=data.max;i++){html+='<a href="'+url(i)+'">'+i+'</a>'}}else{start=(data.page-2)>0?data.page-2:1;for(var i=start;i<data.page;i++){html+='<a href="'+url(i)+'">'+i+'</a>'}}html+='<b>'+data.page+'</b>';var end=(data.page+4)<data.max?data.page+4:data.max;for(var i=data.page+1;i<=end;i++){html+='<a href="'+url(i)+'">'+i+'</a>'}if(data.max>6){html+=(data.page==data.max)?'':'<a href="'+url(data.max)+'">&gt;&gt;</a>'}}else if(data.now||data.now==0){if(data.page!=1){html+='<a href="'+url(data.page-1)+'">&lt;</a>'}html+='<b>'+data.page+'</b>';if(data.now==data.size){html+='<a href="'+url(data.page+1)+'">&gt;</a>'}}var ajax='';if(data.ajax){ajax=(typeof data.ajax=='string'?'ajax="'+data.ajax+'"':'ajax');ajax+=' page="'+data.page+'" size="'+data.size+'"';ajax+=(data.url?' url="'+data.url+'" ':'');ajax+=(data.load?' load="'+data.load+'" ':'');if(data.total){ajax+=' total="'+data.total+'"'}else if(data.now){ajax+=' now="'+data.now+'"'}}if(nav==false){return html}return'<nav '+ajax+' class="pages">'+html+'</nav>'}(function(){var batchs=document.querySelectorAll('[batch]');if(batchs.length){for(var i=0;i<batchs.length;i++){var batch=batchs[i].getAttribute('batch');var checkboxs;if(batch.substring(0,1)=='.'||batch.substring(0,1)=='#'){checkboxs=document.querySelectorAll(batch+' [type="checkbox"]')}else{checkboxs=document.querySelectorAll('[name="'+batch+'"][type="checkbox"]')}if(checkboxs.length){var verify=batchs[i].parentNode.querySelector('[verify][type="checkbox"]');batchs[i].onclick=function(){var type=this.getAttribute('type')||'all';switch(type){case'invert':var ci=0;for(var i=0;i<checkboxs.length;i++){if(checkboxs[i].checked){checkboxs[i].checked=false}else{ci++;checkboxs[i].checked=true}}if(verify){verify.checked=(ci>0)}break;case'reset':for(var i in checkboxs){checkboxs[i].checked=false}if(verify){verify.checked=false}break;default:for(var i in checkboxs){checkboxs[i].checked=true}if(verify){verify.checked=true}break}}if(verify){for(var ii=0;ii<checkboxs.length;ii++){if(verify.checked==false&&checkboxs[ii].checked){verify.checked=true}checkboxs[ii].onchange=function(){if(this.checked){verify.checked=true}else{for(var iii=0;iii<checkboxs.length;iii++){if(checkboxs[iii].checked){verify.checked=true;break}verify.checked=false}}}}}}}}})();var ajax_function={comments:function name(data,form,submitter){var json=JSON.parse(data);if(json.message){dialog_msg(json.message,'comments_msg');if(json.add){submitter.innerText=parseInt(submitter.innerText)+1}}else{dialog_msg('处理异常','comments_msg')}},state:function name(data,form,submitter){var json=JSON.parse(data);if(json.message){dialog_msg(json.message,'state_msg');if(json.results){var states=form.querySelectorAll('[name="ids"]:checked + span');var state=submitter.innerText;var state_value=submitter.value;for(var i=0;i<states.length;i++){states[i].innerText=state;states[i].removeAttribute('s1');states[i].removeAttribute('s0');states[i].removeAttribute('s2');states[i].setAttribute('s'+state_value,'change')}}}else{dialog_msg('处理异常','state_msg')}}}var ajax_form=document.querySelectorAll('form[ajax]');for(var i=0;i<ajax_form.length;i++){var submitter=false;ajax_form[i].onclick=function(ev){if(ev.target.type=='submit'){submitter=ev.target}}ajax_form[i].onsubmit=function(ev){var ev=ev||window.event;if(ev.preventDefault){ev.preventDefault()}else{ev.returnValue=false}if(ev.submitter){submitter=ev.submitter}var data=[];var inputs=this.querySelectorAll('input[name],textarea[name]');for(var i=0;i<inputs.length;i++){if(inputs[i].type=='radio'||inputs[i].type=='checkbox'){if(inputs[i].checked){data.push({name:inputs[i].name,value:inputs[i].value})}}else{data.push({name:inputs[i].name,value:inputs[i].value})}}var selects=this.querySelectorAll('select[name]');for(var i=0;i<selects.length;i++){data.push({name:selects[i].name,value:selects[i].options[selects[i].selectedIndex].value})}if(submitter.name){data.push({name:submitter.name,value:submitter.value})}data.push({name:'ajax',value:'true'});var ajax_fun=this.getAttribute('ajax');var _this=this;AJAX({url:_this.action||location.href,type:_this.method||'GET',contentType:_this.enctype||'application/x-www-form-urlencoded',data:data,success:function(data,xhr){try{if(ajax_function[ajax_fun]){ajax_function[ajax_fun](data,_this,submitter,this)}else{var json=JSON.parse(data);if(json.message){dialog_msg(json.message,'ajaxform_msg')}else{dialog_msg('处理异常','ajaxform_msg')}}}catch(error){dialog_msg('处理异常，请重试','ajaxform_msg')}},error:function(xhr){try{if(ajax_function[ajax_fun]){ajax_function[ajax_fun](xhr.responseText,_this,submitter,this)}else{var json=JSON.parse(xhr.responseText);if(json.message){dialog_msg(json.message,'ajaxform_msg');return}}}catch(error){dialog_msg('处理异常，请重试','ajaxform_msg')}}});return false}}(function(){var img=document.querySelector('meta[property="og:image"]')?document.querySelector('meta[property="og:image"]').getAttribute('content'):'';if(!img){var list_img=document.querySelector('section[list] img');if(list_img){img=list_img.src}else{img=document.images.length?document.images[0].src:''}}if(img){document.body.style.backgroundImage='url("'+img+'")'}})();(function(){var tag_nav=document.querySelector('section[play] + section[info] article nav');if(tag_nav){var tag_nav_as=tag_nav.getElementsByTagName('a');var tags=[];for(var i=0;i<tag_nav_as.length;i++){tags.push(tag_nav_as[i])}var desc=document.querySelector('section[play] + section[info] article').innerText+' '+(document.querySelector('meta[property="og:title"][content]')?document.querySelector('meta[property="og:title"]').getAttribute('content'):document.title);if(desc){var desc_tag=desc.replace(/[ ，。@_#\$%\^&\*、━｜.\?\!？=+\-—\\《》"”“'（）\[\]【】<>！:：]/g,',').split(',');var html='';for(var i=0;i<desc_tag.length;i++){var v=desc_tag[i];if(v&&v.length>1&&v.length<8&&tags.indexOf(v)==-1){if(desc_tag.length>20){if((/^\w+$/.test(v))==false){html+='<a href="/search-'+v+'">'+v+'</a>'}}else if(desc_tag.length>10){if((/^\d+$/.test(v)||/^[a-zA-Z]+$/.test(v))==false){html+='<a href="/search-'+v+'">'+v+'</a>'}}else{html+='<a href="/search-'+v+'">'+v+'</a>'}}}if(html){tag_nav.insertAdjacentHTML('beforeend',html)}}}})();(function(){var search=document.querySelector('header>form>[type="search"]');if(search&&!search.value){var search_tag_nav_a=document.querySelectorAll('section[nav] nav>a');var keywords=[];for(var i=0;i<search_tag_nav_a.length;i++){keywords.push(search_tag_nav_a[i].innerText)}if(keywords.length){var interval=setInterval(function(){search.value=keywords[Math.floor(Math.random()*keywords.length)]},10000);search.onfocus=function(){if(interval){clearInterval(interval);interval=false;search.value=''}}}}})();
